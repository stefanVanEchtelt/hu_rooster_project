
<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../../bower_components/paper-radio-group/paper-radio-group.html">
<link rel="import" href="../../bower_components/paper-radio-button/paper-radio-button.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../bower_components/app-storage/app-localstorage/app-localstorage-document.html">
<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">


<dom-module id="popup-absent">
  <template>
    <style>
      #absent_melden_popup_container {
        display: none; /* Hidden by default */
        position: fixed; /* Stay in place */
        display: none;
        position: fixed;
        padding-top: 0px;
        z-index: 1;
        background-color: white;
        border-style: solid;
        border-width: 2px;
        margin:0 auto;
        top:50%;
      }

      h1 {
        position: relative;
        padding-left: 10px;
        margin-top: 0px;
        margin-bottom: 0px;
        background-color: #4286f4;
        color: white;
      }

      p {
        margin-top: 0px;
        margin-bottom: 0px;
        margin-left: 10px;
        margin-right: 10px;
      }

      .baseModalContent {
        padding-top: 0px;
        padding-bottom: 0px;
        margin-top: 0px;
        margin-bottom: 0px;
      }

      #andersTextInput {
        margin-top: 0px;
        padding-top: 0px;
      }

      #absent_melden_buttons {
        margin-left: 10px;
        margin-top: 10px;
        margin-bottom: 5px;
      }

      #medischInput {
        display: none;
        margin-top: 5px;
      }

      #andersInput {
        display: none;
        margin-top: 5px;
      }

    </style>

    <!-- <button id="absent_melden_open_button" raised on-click="openHandler">Absent melden</button> -->
    <div id="absent_melden_popup_container">
        <paper-dialog id="absent_dialog" modal>
          <template is="dom-if" if="{{isStudent(c_rol)}}">
                  <h1>Absent melden</h1>
                  <form id="absent_melden_form" onsubmit="return false">
                      <p>
                          <b>Reden van absentie:</b><br>
                          <input type="radio" id="radioZiek" value="Ziek" raised on-click="ziekHandler" name="absentie_soort">Ziek</input><br>
                          <input type="radio" id="radioTandarts" value="Tandarts" raised on-click="tandartsHandler" name="absentie_soort">Tandarts</input><br>
                          <input type="radio" id="radioDokter" value="Dokter" raised on-click="dokterHandler" name="absentie_soort">Dokter</input><br>
                          <input type="radio" id="radioAnders" value="nee" raised on-click="andersHandler" name="absentie_soort">Anders, namelijk:</input>
                          <input type="text" name="absentie_soort_anders"></input>
                      </p>
                      <div id="medischInput">
                          <p><b>Wanneer is de absentie?</b><br>
                              Op: <input type="date" name="medischDatum"><br>
                              Van: <input type="time" name="medischTijdBegin"></input> Tot: <input type="time" name="medischTijdEinde">
                      </div>
                      <div id="andersInput">
                          <p><b>Wanneer is de absentie?</b><br>
                              Van: <input type="date" id="andersVanafDatum"></input> om: <input type="time" id="andersVanafTijd"></input><br>
                              Tot: <input type="date" id="andersTotDatum"></input> om: <input type="time" id="andersTotTijd"></input>
                      </div>
                      <div id="absent_melden_buttons">
                          <button raised on-click="cancelHandler">Annuleren</button>
                          <button type="submit" raised on-click="submitHandler">Verzenden</button>
                      </div>
                  </form>
          </template>
          <template is="dom-if" if="{{!isStudent(c_rol)}}">
              <h1>Presentie</h1>
              <form id="presentie_melden" onsubmit="return false">

              </form>
          </template>
        </paper-dialog>
    </div>
    <app-localstorage-document key="afwezigen" data="{{afwezigen}}"></app-localstorage-document>
    <app-localstorage-document key="zieken" data="{{zieken}}"></app-localstorage-document>

    <iron-ajax
      id="ajax_les_ophalen"
      method="POST"
      url="/rooster/les/ophalen"
      handle-as="json"
      on-response="_les_ophalen_response_handler">
    </iron-ajax>

  </template>
            <paper-radio-group selected="ziek" id="radioAbsent" aria-labelledby="label1">
              <paper-radio-button class="baseModalContent" on-click="ziekHandler" name="ziek">Ziek</paper-radio-button><br>
              <paper-radio-button class="baseModalContent" on-click="tandartsHandler" name="tandarts">Tandarts</paper-radio-button><br>
              <paper-radio-button class="baseModalContent" on-click="dokterHandler" name="dokter">Dokter</paper-radio-button><br>
              <paper-radio-button class="baseModalContent" on-click="andersHandler" name="anders">Anders</paper-radio-button>
            </paper-radio-group>
          </p>
          <div id="medischInput">
            <p><b>Wanneer is de absentie?</b><br>
            <paper-input id="medischDatum" type="date" label="Datum:" class="baseModalContent" name="medischDatum"></paper-input>
            <paper-input id="medischTijdBegin" type="time" label="Van:" class="baseModalContent" name="medischTijdBegin"></paper-input>
            <paper-input id="medischTijdEinde" type="time" label="Tot:" name="medischTijdEinde"></paper-input>
          </div>
          <div id="andersInput">
            <p><b>Wanneer is de absentie?</b><br>
            <paper-input id="andersReden" label="Reden:"></paper-input><br>
            <paper-input id="andersDatumVanaf" type="date" label="Vanaf:" class="baseModalContent" id="andersVanafDatum"></paper-input>
            <paper-input id="andersTijdVanaf" type="time" label="om:" class="baseModalContent" id="andersVanafTijd"></paper-input><br>
            <paper-input id="andersDatumTot" type="date" label="Tot:" class="baseModalContent" id="andersTotDatum"></paper-input>
            <paper-input id="andersTijdTot" type="time" label="om:" class="baseModalContent" id="andersTotTijd"></paper-input>
          </div>
          <div id="absent_melden_buttons">
            <paper-button raised on-click="cancelHandler">Annuleren</paper-button>
            <paper-button type="submit" raised on-click="submitHandler">Verzenden</paper-button>
          </div>
        </form>
        </paper-dialog>
      </div>
      <app-localstorage-document key="afwezigen" data="{{afwezigen}}"></app-localstorage-document>
      <app-localstorage-document key="zieken" data="{{zieken}}"></app-localstorage-document>

      <iron-ajax
        id="ajax_les_ophalen"
        method="POST"
        url="/rooster/les/ophalen"
        handle-as="json"
        on-response="_les_ophalen_response_handler">
      </iron-ajax>
  <script>
    class PopupAbsent extends Polymer.Element {
      static get is() { return 'popup-absent'; }
      static get properties() {
        return {
          datum: {
            type: String
          },
          show: {
            type: Boolean,
            value: false,
            observer: '_handel',
          },
          afwezigen: {
            type: Array,
          },
          zieken: {
            type: Array,
          },
          les: {
            type: String,
          },
          c_rol: {
            type: String,
          },
          c_username: {
            type: String,
          },
        };
      }

      _handel() {
        if (this.show) {
          this.openHandler();
        } else {
          this.cancelHandler();
        }
      }

      openHandler() {
        if (this.c_rol == "student") {
          this.$.ajax_les_ophalen.contentType = "application/json";
          this.$.ajax_les_ophalen.body = {
            "datum": this.datum,
            "username": this.username,
            "les": this.les,
          };
          this.$.ajax_les_ophalen.generateRequest();

          var popup = this.root.querySelector('#absent_melden_popup_container');
          popup.style.display = "block";
            this.show = true;

            console.log("y");
        } else {
          console.log(this.zieken);
          console.log(this.c_rol);
            var popup = this.root.querySelector('#absent_melden_popup_container');
            popup.style.display = "block";
        }

      }

      isStudent(rol) {
          if(rol == 'student'){
              return true;
          }else{
              return false;
          }
      }
      _les_ophalen_response_handler(request) {
        console.log("resp");
        console.log(request.detail.response);
      }

      cancelHandler() {
        //console.log("cancel");
        this.show = false;
        var popup = this.root.querySelector('#absent_melden_popup_container');
        popup.style.display = "none";
      }

        ziekHandler(event) {
          this.root.querySelector('#medischInput').style.display = "none";
          this.root.querySelector('#andersInput').style.display = "none";
        }

        tandartsHandler(event) {
            this.root.querySelector('#medischInput').style.display = "block";
            this.root.querySelector('#andersInput').style.display = "none";
        }

        dokterHandler(event) {
          this.root.querySelector('#medischInput').style.display = "block";
          this.root.querySelector('#andersInput').style.display = "none";

        }

        andersHandler(event) {
          this.root.querySelector('#medischInput').style.display = "none";
          this.root.querySelector('#andersInput').style.display = "block";
        }

        submitHandler(event) {
          console.log(this.root.querySelector('#radioAbsent').selected);
          console.log(this.root.querySelector('#medischDatum').value);
          console.log(this.root.querySelector('#medischTijdBegin').value);
          console.log(this.root.querySelector('#medischTijdEinde').value);
          console.log(this.root.querySelector('#andersReden').value);
          console.log(this.root.querySelector('#andersDatumVanaf').value);
          console.log(this.root.querySelector('#andersTijdVanaf').value);
          console.log(this.root.querySelector('#andersDatumTot').value);
          console.log(this.root.querySelector('#andersTijdTot').value);

        // als reden ziek maak lijst met zieken leerlingen
        // anders zet in afweziggen

        let reden = "tandarts";
        if (reden != "ziek") {
          this.afweziggen.push({
            naam: this.c_username,
            reden: reden,
            van: "",
            tot: "",
          });
        } else {
          this.zieken.push({
            naam: this.c_username
          })
        }
      }
    }


        // console.log(this.afweziggen);
        // console.log(this.root.querySelector('#radioZiek').value);
        // console.log(this.root.querySelector('#radioTandarts').value);
        // console.log(this.root.querySelector('#radioDokter').value);
        // console.log(this.root.querySelector('#radioAnders').value);

    window.customElements.define(PopupAbsent.is, PopupAbsent);
  </script>
</dom-module>
